<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>email.contentmanager._encode_text</title>
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
<!--    <link rel="icon" sizes="32x32" href="favicon_32.png">-->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#128270;</text></svg>">
    <link rel="stylesheet" href="highlight.css" type="text/css">
</head>
<body class="pyfile">
<div id="source">
    <div class="highlight">
        <div id="header">
            <div class="content">
                <h1>Method: email.contentmanager._encode_text</h1>
                <span>Calls: 46, </span>
                <span>Exceptions: 8, </span>
                <span>Paths: 9</span>
                <br><a href="index.html">Back</a>
            </div>
        </div>
            <p><b>Path 1</b>: 31 calls (0.67)</p>
                <p><button class="input"><span>&#8594;</span> string</button> 'content' (10) 'foo' (6) 'Simple message.\n' (4) 'arbitrary text as main part' (2) 'more text as a related part' (2) 'yet more text as a second "attac...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (30) 'latin-1' (1) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (31) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (31) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('7bit', 'content\n') (10) ('7bit', 'foo\n') (6) ('7bit', 'Simple message.\n') (4) ('7bit', 'arbitrary text as main part\n') (2) ('7bit', 'more text a...</p>
            <button class="run" title="lines run...">8 run</button>
            <button class="not_run" title="lines not run...">24 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full not_run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full not_run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 2</b>: 5 calls (0.11)</p>
                <p><button class="input"><span>&#8594;</span> string</button> "j'ai un probl&#232;me de python. il est sorti de son vivarium." (1) '\n\n\n\n\n\n\n\n\n\n&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (1) '&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (1) "et l&#224; il est mont&#233; sur moi et...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (5) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (5) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (5) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('8bit', "j'ai un probl\udcc3\udca8me de python. il est sorti de son vivarium.\n") (1) ('8bit', '\n\n\n\n\n\n\n\n\n\n\udcc3\udca1\udcc3\udca0\udcc3\ud...</p>
                <p><button class="warning"><span>&#9888; exception</span></button> UnicodeDecodeError (5) </p>
            <button class="run" title="lines run...">12 run</button>
            <button class="not_run" title="lines not run...">20 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full not_run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full not_run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 3</b>: 2 calls (0.04)</p>
                <p><button class="input"><span>&#8594;</span> string</button> '\n\n\n\n\n\n\n\n\n\n&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (1) "\n\n\n\n\n\n\n\n\n\nj'a...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (2) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (2) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (2) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('quoted-printable', '\n\n\n\n\n\n\n\n\n\n=C3=A1=C3=A0=C3=A4=C3=A9=C3=A8=C4=99=C3=B6=C5=91=C3=A1=C3=\n=A0=C3=A4=C3=A9=C3=A8=C4=99=C3=B6=C5=91=C3=A1=C3...</p>
            <button class="run" title="lines run...">19 run</button>
            <button class="not_run" title="lines not run...">13 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 4</b>: 2 calls (0.04)</p>
                <p><button class="input"><span>&#8594;</span> string</button> "j'ai un probl&#232;me de python. il est sorti de son vivarium.  et l&#224; il est mont&#233; sur moi et il commence &#224; m'&#233;to.\n" (1) 'Simple but long message that is...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (2) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (2) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (2) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('quoted-printable', "j'ai un probl=C3=A8me de python. il est sorti de son vivari=\num.  et l=C3=A0 il est mont=C3=A9 sur moi et il commence =\n=C3=A0...</p>
            <button class="run" title="lines run...">14 run</button>
            <button class="not_run" title="lines not run...">18 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full not_run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full not_run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 5</b>: 2 calls (0.04)</p>
                <p><button class="input"><span>&#8594;</span> string</button> '&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (2) </p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'ascii' (2) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (1) '7bit' (1) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (2) </p>
                <p><button class="warning"><span>&#9888; exception</span></button> UnicodeEncodeError (2) </p>
            <button class="run" title="lines run...">1 run</button>
            <button class="not_run" title="lines not run...">31 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full not_run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full not_run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full not_run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full not_run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full not_run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full not_run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 6</b>: 1 calls (0.02)</p>
                <p><button class="input"><span>&#8594;</span> string</button> '&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (1) </p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (1) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> None (1) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (1) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('base64', 'w6HDoMOkw6nDqMSZw7bFkcOhw6DDpMOpw6jEmcO2xZHDocOgw6TDqcOoxJnD\ntsWRw6HDoMOkw6nDqMSZw7bFkcOhw6DDpMOpw6jEmcO2xZHDocOgw6TDqcOo\nxJnDtsWRw6HDoM...</p>
            <button class="run" title="lines run...">18 run</button>
            <button class="not_run" title="lines not run...">14 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 7</b>: 1 calls (0.02)</p>
                <p><button class="input"><span>&#8594;</span> string</button> '&#225;&#224;&#228;&#233;&#232;&#281;&#246;&#337;.\n' (1) </p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (1) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> '7bit' (1) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (1) </p>
                <p><button class="warning"><span>&#9888; exception</span></button> UnicodeDecodeError (1) </p>
            <button class="run" title="lines run...">7 run</button>
            <button class="not_run" title="lines not run...">25 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full not_run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 8</b>: 1 calls (0.02)</p>
                <p><button class="input"><span>&#8594;</span> string</button> 'xy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy ax...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (1) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> 'base64' (1) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (1) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('base64', 'eHkgYXh5IGF4eSBheHkgYXh5IGF4eSBheHkgYXh5IGF4eSBheHkgYXh5IGF4eSBheHkgYXh5IGF4\neSBheHkgYXh5IGF4eSBheHkgYXh5IGF4eSBheHkgYXh5IGF4eSBheHkgYXh5...</p>
            <button class="run" title="lines run...">11 run</button>
            <button class="not_run" title="lines not run...">21 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full not_run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
            <p><b>Path 9</b>: 1 calls (0.02)</p>
                <p><button class="input"><span>&#8594;</span> string</button> 'xy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy ax...</p>
                <p><button class="input"><span>&#8594;</span> charset</button> 'utf-8' (1) </p>
                <p><button class="input"><span>&#8594;</span> cte</button> 'quoted-printable' (1) </p>
                <p><button class="input"><span>&#8594;</span> policy</button> EmailPolicy (1) </p>
                <p><button class="output"><span>&#8617; return</span></button> ('quoted-printable', 'xy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy axy ax=\ny axy axy axy axy axy axy axy axy axy axy axy ax...</p>
            <button class="run" title="lines run...">11 run</button>
            <button class="not_run" title="lines not run...">21 not run</button>
            <pre>
<span class="num"><a href="#1">1</a></span><span><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charset</span><span class="p">,</span> <span class="n">cte</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span></span>
<span class="num"><a href="#2">2</a></span><span class="full run">    <span class="n">lines</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span></span>
<span class="num"><a href="#3">3</a></span><span class="full run">    <span class="n">linesep</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#4">4</a></span><span class="full run">    <span class="k">def</span> <span class="nf">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">linesep</span></span>
<span class="num"><a href="#5">5</a></span><span class="full run">    <span class="k">def</span> <span class="nf">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span>
<span class="num"><a href="#6">6</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></span>
<span class="num"><a href="#7">7</a></span><span>        <span class="c1"># Use heuristics to decide on the &quot;best&quot; encoding.</span></span>
<span class="num"><a href="#8">8</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">:</span></span>
<span class="num"><a href="#9">9</a></span><span class="full not_run">            <span class="k">try</span><span class="p">:</span></span>
<span class="num"><a href="#10">10</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;7bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#11">11</a></span><span class="full not_run">            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span></span>
<span class="num"><a href="#12">12</a></span><span class="full not_run">                <span class="k">pass</span></span>
<span class="num"><a href="#13">13</a></span><span class="full not_run">            <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">cte_type</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#14">14</a></span><span class="full not_run">                <span class="k">return</span> <span class="s1">&#39;8bit&#39;</span><span class="p">,</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#15">15</a></span><span class="full not_run">        <span class="n">sniff</span> <span class="o">=</span> <span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span></span>
<span class="num"><a href="#16">16</a></span><span class="full not_run">        <span class="n">sniff_qp</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">sniff</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#17">17</a></span><span class="full not_run">                                          <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#18">18</a></span><span class="full not_run">        <span class="n">sniff_base64</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_base64</span><span class="p">(</span><span class="n">sniff</span><span class="p">)</span></span>
<span class="num"><a href="#19">19</a></span><span>        <span class="c1"># This is a little unfair to qp; it includes lineseps, base64 doesn&#39;t.</span></span>
<span class="num"><a href="#20">20</a></span><span class="full not_run">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_qp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sniff_base64</span><span class="p">):</span></span>
<span class="num"><a href="#21">21</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;base64&#39;</span></span>
<span class="num"><a href="#22">22</a></span><span>        <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#23">23</a></span><span class="full not_run">            <span class="n">cte</span> <span class="o">=</span> <span class="s1">&#39;quoted-printable&#39;</span></span>
<span class="num"><a href="#24">24</a></span><span class="full not_run">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span></span>
<span class="num"><a href="#25">25</a></span><span class="full not_run">                <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">sniff_qp</span></span>
<span class="num"><a href="#26">26</a></span><span class="full run">    <span class="k">if</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;7bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#27">27</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#28">28</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;8bit&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#29">29</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span></span>
<span class="num"><a href="#30">30</a></span><span class="full run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;quoted-printable&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#31">31</a></span><span class="full run">        <span class="n">data</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">normal_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span></span>
<span class="num"><a href="#32">32</a></span><span class="full run">                                      <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#33">33</a></span><span class="full not_run">    <span class="k">elif</span> <span class="n">cte</span> <span class="o">==</span> <span class="s1">&#39;base64&#39;</span><span class="p">:</span></span>
<span class="num"><a href="#34">34</a></span><span class="full not_run">        <span class="n">data</span> <span class="o">=</span> <span class="n">_encode_base64</span><span class="p">(</span><span class="n">embedded_body</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">policy</span><span class="o">.</span><span class="n">max_line_length</span><span class="p">)</span></span>
<span class="num"><a href="#35">35</a></span><span>    <span class="k">else</span><span class="p">:</span></span>
<span class="num"><a href="#36">36</a></span><span class="full not_run">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown content transfer encoding </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">))</span></span>
<span class="num"><a href="#37">37</a></span><span class="full run">    <span class="k">return</span> <span class="n">cte</span><span class="p">,</span> <span class="n">data</span></span>
            </pre>
    </div>
</div>
<i class="bi bi-arrow-down"></i>
</body>
</html>
